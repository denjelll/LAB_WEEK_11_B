1. Bagian Kode yang Menangani Penyimpanan Gambar Berdasarkan URI

Proses pemberian jalur penyimpanan kepada aplikasi kamera (berdasarkan URI) yang kemudian digunakan kamera untuk menyimpan data gambar sementara ditangani oleh kode berikut, yang berada di dalam `MainActivity`:

private fun openImageCapture() {
    photoInfo =
        providerFileManager.generatePhotoUri(System.currentTimeMillis())
    takePictureLauncher.launch(photoInfo?.uri)
}
Secara spesifik, takePictureLauncher.launch(photoInfo?.uri) memberikan URI yang dihasilkan dari photoInfo kepada launcher kamera, yang memberi tahu sistem di mana harus meletakkan file hasil tangkapan.

2. Penjelasan Atribut di FileInfo.kt

Di dalam data model FileInfo (yang memiliki 5 atribut), berikut adalah penjelasan untuk atribut pertama dan keempat:

Atribut Pertama (URI):

URI (android.net.Uri) ini merujuk pada jalur yang dapat diakses oleh aplikasi kamera (pihak ketiga) untuk menulis data file yang baru diambil. URI ini umumnya dihasilkan oleh FileProvider dan menunjuk ke lokasi penyimpanan sementara di dalam direktori private aplikasi Anda.

Atribut Keempat (relativePath):

relativePath merujuk pada jalur folder relatif di dalam Shared Storage (seperti Pictures atau Videos) tempat file akan disimpan secara permanen di MediaStore. Atribut ini sangat penting dan wajib digunakan untuk mekanisme Scoped Storage pada Android 10 (API 29) ke atas.

3. Urutan Kronologis Proses Penyimpanan
Berikut adalah urutan kronologis dari saat pengguna mengambil gambar hingga file disimpan secara permanen di MediaStore:

1) URI Sementara Dibuat: Panggilan ke providerFileManager.generatePhotoUri() membuat objek FileInfo baru. Atribut uri pada objek ini menunjuk ke lokasi penyimpanan sementara (melalui FileProvider).

2) Kamera Diluncurkan: takePictureLauncher.launch(photoInfo?.uri) meluncurkan aplikasi kamera eksternal dan memberinya izin tulis ke URI sementara tersebut.

3) Pengambilan Data: Pengguna mengambil foto. Aplikasi kamera menulis data gambar ke lokasi sementara yang ditentukan oleh URI yang diberikan di Langkah 2.

4) Pemicu Penyimpanan Permanen: Setelah kamera selesai, takePictureLauncher memicu callback yang memanggil providerFileManager.insertImageToStore(photoInfo).

5) Penyisipan MediaStore: Fungsi insertToStore dipanggil:

- Penciptaan Placeholder: contentResolver.insert() membuat entri placeholder baru di MediaStore menggunakan ContentValues (yang berisi relativePath). Ini mengembalikan insertedUriâ€”jalur penyimpanan permanen di Shared Storage.

- Penyalinan Data: Data dari lokasi sementara (fileInfo.uri) dibaca menggunakan inputStream dan disalin secara byte-per-byte ke lokasi permanen (insertedUri) melalui outputStream menggunakan IOUtils.copy().

6) Selesai: File gambar kini tersimpan secara permanen di MediaStore.